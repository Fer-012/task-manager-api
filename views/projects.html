<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Normalize CSS (resets styles) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css">

  <!-- Third-party Icon Fonts -->
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">


  <!-- Core CSS (should load first) -->
  <link rel="stylesheet" href="assets/vendor/css/core.css" class="template-customizer-core-css">

  <!-- Theme and Layout Styles -->
  <link rel="stylesheet" href="assets/vendor/css/theme-default.css" class="template-customizer-theme-css">
  <link rel="stylesheet" href="css/theme.css">

  <!-- Additional Demo Styles -->
  <link rel="stylesheet" href="assets/css/demo.css">

  <!-- Vendor CSS -->
  <link rel="stylesheet" href="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css">

  <!-- Custom Styles (Should Load Last) -->
  <link rel="stylesheet" href="css/custom.css">

</head>
<style>
  .status-badge {
    display: inline-block;
    padding: 5px 10px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 10px;
    text-align: center;
    min-width: 90px;
  }

  .status-in-progress {
    background-color: #d1f0ff;
    color: #00a3ff;
  }

  .status-completed {
    background-color: #d4edda;
    color: #218838;
  }

  .status-canceled {
    background-color: #f8d7da;
    color: #dc3545;
  }

  .status-pending {
    background-color: #fff3cd;
    color: #ffc107;
  }
</style>

<body>
  <div id="db-wrapper">
    <div id="alertContainer" class="alert-container"></div>
    <!-- Sidebar -->
    <nav class="navbar-vertical navbar">
      <div class="nav-scroller">
        <!-- Brand logo -->
        <a class="navbar-brand" href="/dashboard">
          <img src="images/brand/logo/logo.svg" alt="" />
        </a>
        <!-- Navbar nav -->
        <ul class="navbar-nav flex-column" id="sideNavbar">
          <li class="nav-item">
            <a class="nav-link" href="/dashboard">
              <i class='bx bx-home-alt me-2'></i>Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link has-arrow " href="/myTaskes">
              <i class='bx bx-check-circle me-2'></i>My tasks
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link has-arrow" href="inbox.html">
              <i class='bx bx-bell me-2'></i>Inbox
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link has-arrow active " href="/projects">
              <i class='bx bx-objects-horizontal-left me-2'></i> Projects
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link has-arrow " href="workspace.html">
              <i class='bx bx-group me-2'></i> My workspace
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link has-arrow " href="reports.html">
              <i class='bx bx-network-chart me-2'></i> Reports
            </a>
          </li>
        </ul>
      </div>
    </nav>
    <!-- Page content -->
    <div id="page-content">
      <div class="header @@classList">
        <!-- navbar -->
        <nav class="navbar-classic navbar navbar-expand-lg">
          <a id="nav-toggle" href="#"><i data-feather="menu" class="nav-icon me-2 icon-xs"></i></a>
          <div class="ms-lg-3 d-none d-md-none d-lg-block">
            <!-- Form -->
            <form class="d-flex align-items-center">
              <input type="search" class="form-control" placeholder="Search" />
            </form>
          </div>
          <!--Navbar nav -->
          <ul class="navbar-nav navbar-right-wrap ms-auto d-flex nav-top-wrap">
            <li class="dropdown stopevent">
              <a class="btn btn-light btn-icon rounded-circle indicator
                indicator-primary text-muted" href="#" role="button" id="dropdownNotification"
                data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class='bx bx-bell icon-xs"'></i>
              </a>
              <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end" aria-labelledby="dropdownNotification">
                <div class="">
                  <div class="border-bottom px-3 pt-2 pb-3 d-flex
                    justify-content-between align-items-center">
                    <p class="mb-0 text-dark fw-medium fs-4">Notifications</p>
                    <a href="#" class="text-muted">
                      <span>
                        <i class="me-1 icon-xxs" data-feather="settings"></i>
                      </span>
                    </a>
                  </div>
                  <!-- List group -->
                  <ul class="list-group list-group-flush notification-list-scroll">
                    <!-- List group item -->
                    <li class="list-group-item bg-light">


                      <a href="#" class="text-muted">
                        <h5 class="fw-bold mb-1">Rishi Chopra</h5>
                        <p class="mb-0">
                          Mauris blandit erat id nunc blandit, ac eleifend dolor pretium.
                        </p>
                      </a>



                    </li>
                    <!-- List group item -->
                    <li class="list-group-item">


                      <a href="#" class="text-muted">
                        <h5 class="fw-bold mb-1">Neha Kannned</h5>
                        <p class="mb-0">
                          Proin at elit vel est condimentum elementum id in ante. Maecenas et sapien metus.
                        </p>
                      </a>



                    </li>
                    <!-- List group item -->
                    <li class="list-group-item">


                      <a href="#" class="text-muted">
                        <h5 class="fw-bold mb-1">Nirmala Chauhan</h5>
                        <p class="mb-0">
                          Morbi maximus urna lobortis elit sollicitudin sollicitudieget elit vel pretium.
                        </p>
                      </a>



                    </li>
                    <!-- List group item -->
                    <li class="list-group-item">


                      <a href="#" class="text-muted">
                        <h5 class="fw-bold mb-1">Sina Ray</h5>
                        <p class="mb-0">
                          Sed aliquam augue sit amet mauris volutpat hendrerit sed nunc eu diam.
                        </p>
                      </a>



                    </li>
                  </ul>
                  <div class="border-top px-3 py-2 text-center">
                    <a href="#" class="text-inherit fw-semi-bold">
                      View all Notifications
                    </a>
                  </div>
                </div>
              </div>
            </li>
            <!-- List -->
            <li class="dropdown ms-2">
              <a class="rounded-circle" href="#" role="button" id="dropdownUser" data-bs-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                <div class="avatar avatar-md avatar-indicators avatar-online">
                  <img alt="avatar" src="images/avatar/avatar-1.jpg" class="rounded-circle" />
                </div>
              </a>
              <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownUser">
                <div class="px-4 pb-0 pt-2">


                  <div class="lh-1 ">
                    <h5 class="mb-1"> John E. Grainger</h5>
                    <a href="#" class="text-inherit fs-6">View my profile</a>
                  </div>
                  <div class=" dropdown-divider mt-3 mb-2"></div>
                </div>

                <ul class="list-unstyled">

                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="me-2 icon-xxs dropdown-item-icon" data-feather="user"></i>Edit
                      Profile
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="me-2 icon-xxs dropdown-item-icon" data-feather="activity"></i>Activity Log
                    </a>


                  </li>

                  <li>
                    <a class="dropdown-item text-primary" href="#">
                      <i class="me-2 icon-xxs text-primary dropdown-item-icon" data-feather="star"></i>Go Pro
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="me-2 icon-xxs dropdown-item-icon" data-feather="settings"></i>Account Settings
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="@@webRoot/index.html">
                      <i class="me-2 icon-xxs dropdown-item-icon" data-feather="power"></i>Sign Out
                    </a>
                  </li>
                </ul>

              </div>
            </li>
          </ul>
        </nav>
      </div>
      <!-- Container fluid -->
      <div class="bg-primary pt-10 pb-21"></div>
      <div class="container-fluid mt-n22 px-6">
        <div class="row">
          <div class="col-lg-12 col-md-12 col-12">
            <!-- Page header -->
            <div>
              <div class="d-flex justify-content-between align-items-center">
                <div class="mb-2 mb-lg-0">
                  <h3 class="mb-0 fw-bold text-white">Projects</h3>
                </div>
                <div>
                  <a href="/new_project" class="btn btn-white">Create New Project</a>
                </div>
              </div>
            </div>
          </div>
          <div class="col-xl-3 col-lg-6 col-md-12 col-12 mt-6">
            <!-- Total Projects Card -->
            <div class="card rounded-3">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="mb-0">Total Projects</h4>
                  <div class="icon-shape icon-md bg-light-primary text-primary rounded-1">
                    <i class="bi bi-briefcase fs-4"></i>
                  </div>
                </div>
                <h1 class="fw-bold" id="totalProjects">0</h1>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-lg-6 col-md-12 col-12 mt-6">
            <!-- Ongoing Projects Card -->
            <div class="card rounded-3">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="mb-0">Ongoing Projects</h4>
                  <div class="icon-shape icon-md bg-light-warning text-warning rounded-1">
                    <i class="bi bi-hourglass-split fs-4"></i>
                  </div>
                </div>
                <h1 class="fw-bold" id="ongoingProjects">0</h1>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-lg-6 col-md-12 col-12 mt-6">
            <!-- Completed Projects Card -->
            <div class="card rounded-3">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="mb-0">Completed Projects</h4>
                  <div class="icon-shape icon-md bg-light-success text-success rounded-1">
                    <i class="bi bi-check-circle fs-4"></i>
                  </div>
                </div>
                <h1 class="fw-bold" id="completedProjects">0</h1>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-lg-6 col-md-12 col-12 mt-6">
            <!-- Canceled Projects Card -->
            <div class="card rounded-3">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="mb-0">Canceled Projects</h4>
                  <div class="icon-shape icon-md bg-light-danger text-danger rounded-1">
                    <i class="bi bi-x-circle fs-4"></i>
                  </div>
                </div>
                <h1 class="fw-bold" id="canceledProjects">0</h1>
              </div>
            </div>
          </div>

          <script>
            async function fetchProjectsStats() {
              const token = localStorage.getItem("token");
              const response = await fetch("/api/projects/all", {
                method: "GET",
                headers: {
                  "Authorization": `Bearer ${token}`,
                },
              });
              const projects = await response.json();

              const totalProjects = projects.length;
              const ongoingProjects = projects.filter(p => p.status === "Ongoing").length;
              const completedProjects = projects.filter(p => p.status === "Completed").length;
              const canceledProjects = projects.filter(p => p.status === "Canceled").length;

              document.getElementById("totalProjects").innerText = totalProjects;
              document.getElementById("ongoingProjects").innerText = ongoingProjects;
              document.getElementById("completedProjects").innerText = completedProjects;
              document.getElementById("canceledProjects").innerText = canceledProjects;
            }

            fetchProjectsStats();
          </script>
        </div>
        <!-- row  -->
        <div class="row mt-6">
          <div class="col-md-12 col-12">
            <!-- card  -->
            <div class="card">
              <!-- card header  -->
              <div class="card-header bg-white border-bottom-0 py-4">
                <h4 class="mb-0">Active Projects</h4>
              </div>
              <!-- table  -->
              <div class="table-responsive">
                <table class="table text-nowrap mb-0">

                  <thead class="table-light">
                    <tr>
                      <th>Name</th>
                      <th>Start Date</th>
                      <th>End Date</th>
                      <th>Priority</th>
                      <th>Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  <tbody id="projectsTable">
                    <script>
                      async function fetchProjects() {
                        const token = localStorage.getItem("token");
                        const response = await fetch("/api/projects/all", {
                          method: "GET",
                          headers: {
                            "Authorization": `Bearer ${token}`,
                          },
                        });

                        const projects = await response.json();
                        const tableBody = document.getElementById("projectsTable");
                        tableBody.innerHTML = "";

                        projects.forEach(project => {
                          const startDate = new Date(project.start_date);
                          const endDate = new Date(project.end_date);

                          const formattedStartDate = startDate.toISOString().split('T')[0];
                          const formattedEndDate = endDate.toISOString().split('T')[0];

                          // Define status styles
                          let statusClass;
                          switch (project.status.toLowerCase()) {
                            case "in progress":
                              statusClass = "status-in-progress";
                              break;
                            case "completed":
                              statusClass = "status-completed";
                              break;
                            case "canceled":
                            case "cancel":
                              statusClass = "status-canceled";
                              break;
                            case "pending":
                              statusClass = "status-pending";
                              break;
                            default:
                              statusClass = "status-pending"; // Default to pending if not recognized
                          }

                          const row = `<tr>
                                <td>${project.name}</td>
                                <td>${formattedStartDate}</td>
                                <td>${formattedEndDate}</td>
                                <td>${project.priority}</td>
                                <td><span class="status-badge ${statusClass}">${project.status}</span></td>
                                <td>
                                            
                                                <a href="/projects/view/${project._id}" class="btn btn-primary me-2">
                                                      <span class="icon-base bx bx-show"></span>
                                                </a>
                                                <a href="/projects/edit/${project._id}" class="btn btn-warning me-2">
                                                    <span class="icon-base bx bx-edit-alt" style="color:#fff"></span>
                                                </a>
                                                <button onclick="deleteProject('${project._id}')" class="btn btn-danger me-2">
                                                    <span class="icon-base bx bx-trash"></span>
                                                </button>
                                                <a href="/tasks?project_id=${project._id}" class="btn btn-primary me-2">
                                                    <span class="icon-base bx bx-plus me-1"></span>Task
                                                </a>
                                </td>
                              </tr>`;
                          tableBody.innerHTML += row;
                        });
                      }
                      function showAlert(message, type) {
                        const alertContainer = document.getElementById("alertContainer");
                        alertContainer.innerHTML = `
                              <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                                ${message}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                              </div>`;

                        // Auto-hide alert after 3 seconds
                        setTimeout(() => {
                          alertContainer.innerHTML = "";
                        }, 3000);
                      }

                      async function deleteProject(id) {
                        const token = localStorage.getItem("token");
                        const confirmDelete = confirm("Are you sure you want to delete this project?");
                        if (confirmDelete) {
                          try {
                            const response = await fetch(`/api/projects/delete/${id}`, {
                              method: "DELETE",
                              headers: {
                                "Authorization": `Bearer ${token}`,
                              },
                            });

                            if (response.ok) {
                              showAlert("Project deleted successfully!", "success");
                              fetchProjects(); // Refresh the project list
                            } else {
                              const errorData = await response.json();
                              showAlert(`Error: ${errorData.message}`, "danger");
                            }
                          } catch (error) {
                            showAlert("Error deleting project!", "danger");
                            console.error(error);
                          }
                        }
                      }
                      fetchProjects();
                    </script>
                  </tbody>
              </table>
            </div>

            <!-- card footer  -->
            <div class="card-footer bg-white text-center">
              <a href="#"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>

  <!-- Scripts -->
  <!-- clipboard -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.12/clipboard.min.js"></script>

  <script src="js/main.js"></script>
  <script src="js/feather.js"></script>
  <script src="js/copyButton.js"></script>
  <script src="js/sidebarMenu.js"></script>
  <script src="js/dashboard.js"></script>
  <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="assets/vendor/libs/jquery/jquery.js"></script>
  <script src="assets/vendor/libs/popper/popper.js"></script>
  <script src="assets/vendor/js/bootstrap.js"></script>
  <script src="assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

  <script src="assets/vendor/js/menu.js"></script>
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="assets/vendor/libs/apex-charts/apexcharts.js"></script>

  <!-- Main JS -->
  <script src="assets/js/main.js"></script>

  <!-- Page JS -->
  <script src="assets/js/dashboards-analytics.js"></script>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>


</body>

</html>